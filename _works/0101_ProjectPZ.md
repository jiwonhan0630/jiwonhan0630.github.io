---
layout: basic
title: "Project PZ"
description: "2021-2025"
image: /images/pic01.jpg
---

## 프로젝트 개요

## 담당 업무
- [Wang Tile](https://en.wikipedia.org/wiki/Wang_tile)을 응용한 절차적 레벨 생성
    - 생성된 데이터를 통해 런타임 지형 메쉬 생성 및 최적화된 텍스처 적용
    - 플레이 데이터에 따라 구조물의 종류와 위치가 변경됨
- UIToolkit을 사용한 커스텀 에디터 구현
    - 절차적 레벨 생성을 위한 베이스 데이터 제작 툴
    - 고정된 레벨을 위한 레벨 제작 툴
    - 몬스터 패턴 디버깅 툴
- 데이터 기반 몬스터 패턴 시스템 구현
- CSV 형식 파싱 자동화(?)
- Tilemap을 사용한 인게임 월드맵 구현
- UniTask 사용


## Details

### 절차적 레벨 생성
미리 만들어진 작은 지형 데이터의 집합으로 영역을 만들고, 영역의 집합으로 하나의 레벨을 만들어내는 로직을 구현하였습니다.  
영역과 영역은 인접 가능한 지점이 정해져있고, 해당 지점을 통해서만 이동이 가능한 구조로 생성되어야 했음  
이는 절차적 텍스처 합성에 사용되는 Wang Tile을 응용하여 실현 가능하다고 판단, 생성 로직을 구상 후 문서로 작성하여 디자이너와 나의 뇌를 동기화.  

이후 지형의 회전, 영역 사이를 잇는 다리의 생성 등의 스펙이 추가되어 기존 생성 로직에 덧붙이는 느낌으로 구현하였음.  
이 시점부터 레벨 생성에 걸리는 시간이 기하급수적으로 늘어나 리팩토링 시작.  
Profiler를 통해 파악된 원인은 잦은 메모리 할당으로 인한 가비지콜렉터의 노동과... 함수 호출 과정에서의 오버헤드인데, 정말 아주 환상적으로 문제가 섞여있었음.  

지금 당장 기억나는거로는 객체를 새로 생성하지 않고 내부 변수의 값만 바꾸고...  
배열을 새로 생성하는 함수를 그냥 배열은 냅두고 요소의 값만 바꾸는 방식으로 변경하고...  
뭔가...콜렉션 쪽에서도......List 순회를 HashSet으로 바꿔서 O(n) 연산을 O(1)로 바꾸기도 했고...  
List도 미리 크기 예측해서 만들어놓음...  
LINQ 쓰던 부분도 그냥 for로 바꿨음...ToDictionary같은거 쓰니까 새로운 객체가 만들어지더라고요...  

그리고 배열에 접근->요소의 값 변경-> Contains 실행 이 방식도 그냥 배열 자체를 제거하고 Contains(계산한 값)만 사용해서 메모리 안거치고 계산하도록 수정함...  
그리고 로직도 '실패를 빠르게 알아차리는' 구조로 바꿔서 실행 시간을 줄이려고 노력했음...  
사소한거라고 생각했던 부분들을 바꾼게 큰 차이를 만들어내는게 참 좋았음...  

### 지형 데이터 제작 툴
결과적으로는 그림판 수준이지만 일단 기능 나열...  
- 포토샵 같은 곳에 있는 네비게이션 기능
- 브러쉬 크기 조절, 브러쉬 마스크 기능...
- 인게임 적용 예시 보기(?)
    - 지금까지의 데이터를 인게임처럼 보여준다. 인게임과 동일한 메시 생성기를 사용하므로 모듈화도 되어있다는 걸 자랑할 수 있다...  
    - 플레이어 조작도 가능...
- 에셋 프리뷰 쪽에서 시각화된 상태로 보여준다...
    - 팀원들의 빠른 보고서 작성을 위해 png로 출력해주는 기능도 있음...  
UIToolkit을 사용하여 기능과 디자인을 분리했으므로 나중에 UI 디자이너가 요소를 수정하기 편하게 했음...  

### 몬스터 패턴 디버깅 툴
몬스터가 어떤 틱에서 어떤 행동을 취했는지 목록으로 보여준다...  
디자이너가 작성한 데이터대로 굴러가는지 보는 용도였다...  

### 데이터 기반 몬스터 패턴 시스템
디자이너가 쓴 텍스트를 파싱해서 지정된 함수를 호출시키는 형태이다...  

### CSV 형식 파싱 자동화(?)
이거는 Attribute를 통해서...헤더의 이름과 동일한 변수에 값을 넣어주는 친구이다...  
List와 Dictionary 두가지 방식을 사용할 수 있고...Dictionary의 경우 키를 무슨 값으로 할건지 이름 정해줄 수 있음...  

